<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>3D Viewer - Model 1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        background: linear-gradient(to bottom, #000000, #1a1a1a);
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: sans-serif;
      }

      model-viewer {
        width: 100vw;
        height: 100vh;
        background: transparent;
        opacity: 0;
        transition: opacity 1s ease;
      }

      #close-btn {
        position: fixed;
        top: 12px;
        right: 12px;
        z-index: 100;
        font-size: 28px;
        color: white;
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        text-align: center;
        line-height: 40px;
        cursor: pointer;
      }

      #close-btn:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      #gizmo-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 90;
        width: 80px;
        height: 80px;
        pointer-events: none;
        opacity: 0.8;
      }

      #angles {
        position: fixed;
        bottom: 10px;
        right: 110px;
        color: white;
        font-size: 12px;
        font-family: monospace;
        z-index: 90;
        text-align: right;
      }
    </style>
  </head>
  <body>
    <div id="close-btn" onclick="tryClose()">&#10005;</div>

    <model-viewer
      id="viewer"
      src="model1.glb"
      camera-controls
      auto-rotate
      disable-pan
      ar
      shadow-intensity="1"
      exposure="1"
    ></model-viewer>

    <canvas id="gizmo-container"></canvas>
    <div id="angles">X: 0°<br>Y: 0°<br>Z: 0°</div>

    <audio id="start-sound" src="aparece_cibernetico.mp3"></audio>

    <script>
      function tryClose() {
        if (window.close) window.close();
        else alert("No se puede cerrar esta pestaña desde el navegador.");
      }

      const viewer = document.getElementById("viewer");
      const gizmoCanvas = document.getElementById("gizmo-container");
      const angleText = document.getElementById("angles");
      const sound = document.getElementById("start-sound");

      viewer.addEventListener("load", () => {
        viewer.style.opacity = 1;
        sound.play();
      });

      const ctx = gizmoCanvas.getContext("2d");
      gizmoCanvas.width = 80;
      gizmoCanvas.height = 80;

      function drawGizmo(xRot, yRot, zRot) {
        ctx.clearRect(0, 0, 80, 80);

        // Draw lines for X, Y, Z
        ctx.save();
        ctx.translate(40, 40);

        ctx.strokeStyle = "red"; // X
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(20 * Math.cos(yRot), 20 * Math.sin(yRot));
        ctx.stroke();

        ctx.strokeStyle = "green"; // Y
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(20 * Math.cos(xRot), -20 * Math.sin(xRot));
        ctx.stroke();

        ctx.strokeStyle = "blue"; // Z
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(-20 * Math.sin(zRot), 20 * Math.cos(zRot));
        ctx.stroke();

        ctx.restore();
      }

      function updateRotation() {
        const rot = viewer.getCameraOrbit();
        const x = (rot.phi * 180 / Math.PI).toFixed(0);
        const y = (rot.theta * 180 / Math.PI).toFixed(0);
        const z = 0; // model-viewer does not expose Z directly

        angleText.innerHTML = `X: ${x}°<br>Y: ${y}°<br>Z: ${z}°`;
        drawGizmo(rot.phi, rot.theta, 0);
        requestAnimationFrame(updateRotation);
      }

      requestAnimationFrame(updateRotation);
    </script>
  </body>
</html>
